<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Test Project</title>
  <link rel="stylesheet" href="styles/post.css" />
</head>
<body>
  <!-- 헤더/푸터는 load-layout.js에서 자동으로 삽입됨 -->

  <main style="max-width:1200px; margin:40px auto 0 auto; padding:0 16px;">
    <!-- 이번주 인기작 top 10 (슬라이드) -->
    <section style="margin-bottom:48px;">
      <h2 style="font-size:2rem; margin-bottom:18px;">이번주 인기작 TOP 10</h2>
      <div style="position:relative;">
        <button id="popular-left" style="position:absolute; left:-32px; top:50%; transform:translateY(-50%); z-index:2; background:rgba(0,0,0,0.5); color:#fff; border:none; border-radius:50%; width:40px; height:40px; font-size:2rem; cursor:pointer; display:flex; align-items:center; justify-content:center;">&#60;</button>
        <div id="popular-carousel" style="overflow-x:auto; overflow-y:hidden; white-space:nowrap; scroll-behavior:smooth; padding-bottom:8px;">
          <div style="display:inline-block; width:8px;"></div>
          <!-- 10개 포스트 -->
          <div class="post-card" style="display:inline-block; margin-right:12px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">1</span></div>
            <div class="post-title" style="color:#fff;">인기작 1</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:12px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">2</span></div>
            <div class="post-title" style="color:#fff;">인기작 2</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:12px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">3</span></div>
            <div class="post-title" style="color:#fff;">인기작 3</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:12px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">4</span></div>
            <div class="post-title" style="color:#fff;">인기작 4</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:12px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">5</span></div>
            <div class="post-title" style="color:#fff;">인기작 5</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:24px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">6</span></div>
            <div class="post-title" style="color:#fff;">인기작 6</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:24px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">7</span></div>
            <div class="post-title" style="color:#fff;">인기작 7</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:24px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">8</span></div>
            <div class="post-title" style="color:#fff;">인기작 8</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:24px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">9</span></div>
            <div class="post-title" style="color:#fff;">인기작 9</div>
          </div>
          <div class="post-card" style="display:inline-block; margin-right:24px; position:relative;">
            <div class="poster-box">포스터<span class="poster-rank">10</span></div>
            <div class="post-title" style="color:#fff;">인기작 10</div>
          </div>
          <div style="display:inline-block; width:8px;"></div>
        </div>
        <button id="popular-right" style="position:absolute; right:-32px; top:50%; transform:translateY(-50%); z-index:2; background:rgba(0,0,0,0.5); color:#fff; border:none; border-radius:50%; width:40px; height:40px; font-size:2rem; cursor:pointer; display:flex; align-items:center; justify-content:center;">&#62;</button>
      </div>
      <script>
        const carousel = document.getElementById('popular-carousel');
        document.getElementById('popular-left').onclick = () => {
          carousel.scrollBy({left: -200, behavior: 'smooth'});
        };
        document.getElementById('popular-right').onclick = () => {
          carousel.scrollBy({left: 200, behavior: 'smooth'});
        };
      </script>
    </section>
    <!-- 업로드순(최신순, 최대 20개) -->
    <section style="margin-bottom:48px;">
      <div class="latest-upload-header">
        <h2 style="font-size:2rem; margin-bottom:18px;">최신 업로드</h2>
        <a href="#" class="more-link">더보기 &gt;</a>
      </div>
      <div style="display:grid; grid-template-columns:repeat(7, 1fr); gap:12px;">
        <!-- 7개 예시 포스트 -->
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">최신작 1</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">최신작 2</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">최신작 3</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">최신작 4</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">최신작 5</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">최신작 6</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">최신작 7</div>
        </div>
        <!-- ...최신작 8~20 반복... -->
      </div>
    </section>
    <!-- 관심 웹툰(찜) -->
    <section id="my-favorites-section" style="margin-bottom:48px;">
      <h2 style="font-size:2rem; margin-bottom:18px;">내가 찜한 웹툰</h2>
      <div style="display:grid; grid-template-columns:repeat(7, 1fr); gap:12px;">
        <!-- 7개 예시 포스트 -->
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">찜한 웹툰 1</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">찜한 웹툰 2</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">찜한 웹툰 3</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">찜한 웹툰 4</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">찜한 웹툰 5</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">찜한 웹툰 6</div>
        </div>
        <div class="post-card" style="text-align:center;">
          <div class="poster-box">포스터</div>
          <div class="post-title" style="font-weight:bold;">찜한 웹툰 7</div>
        </div>
        <!-- ...찜한 웹툰 8~10 반복... -->
      </div>
    </section>
  </main>

  <script src="scripts/load-layout.js"></script>
  <script src="scripts/auth.js"></script>
  <script type="module" src="scripts/header.js"></script>
  <script type="module">
    import { auth } from "./scripts/firebase-init.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, collection, getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
    const favSection = document.getElementById('my-favorites-section');
    onAuthStateChanged(auth, (user) => {
      if (favSection) favSection.style.display = user ? '' : 'none';
    });

    async function generateUniqueUserId() {
      const userIdsSnapshot = await getDocs(collection(db, "users"));
      const existingIds = new Set();
      userIdsSnapshot.forEach(doc => {
        const data = doc.data();
        if (data.userId) existingIds.add(data.userId);
      });
      let newId;
      do {
        newId = Math.floor(10000000 + Math.random() * 90000000).toString();
      } while (existingIds.has(newId));
      return newId;
    }
  </script>
</body>
</html>
